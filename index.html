<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="A front-end template that helps you build fast, modern mobile web apps.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <title>Ermington Public School P&C Voluntary Contribution Form</title>

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

  <link rel="icon" sizes="192x192" href="images/android-desktop.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Material Design Lite">
  <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
  <meta name="msapplication-TileColor" content="#3372DF">

  <link rel="shortcut icon" href="images/favicon.png">

  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <!--
    <link rel="canonical" href="http://www.example.com/">
    -->

  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-red.min.css">
  <link rel="stylesheet" href="styles.css">
  <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }

    table {
      font-size: 1.5em;
    }

    .rowTotal {
      text-align: right;
    }

    #amount li {
      display: inline;
      list-style-type: none;
      max-width: 4em;
      min-width: 4em;
      padding: 0.7em;
      line-height: 3em;
      margin: 0.1em;
      border-radius: 1.5em;
      border-width: 1px;
      background-color: cyan;
      color: darkblue;
      cursor: pointer;
    }

    #amount li.suggested {
      border-width: 5px;
      border-color: darkorchid;
      border-style: double;

    }

    #amount li.selected {
      background-color: darkgreen;
      color: lightskyblue;
    }

    #amount li:hover {
      border-width: 4px;
      border-color: darkorange;
      background-color: rgba(4, 12, 27, 0.644);
    }

    .arrow {
      font-size: 12pt;
      height: 1.2em;
    }

    input:invalid{
      border-color: crimson;
      border-style: solid;
      border-width: 2;
    }
  </style>
</head>

<body>
  <div class="demo-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100">
    <header
      class="demo-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800">
      <div class="mdl-layout__header-row">
        <span class="mdl-layout-title">Ermington Public School P&C</span>
        <div class="mdl-layout-spacer"></div>
      </div>
    </header>
    <div class="demo-ribbon"></div>
    <main class="demo-main mdl-layout__content">
      <div class="demo-container mdl-grid">
        <div
          class="demo-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col">

          <h3>Voluntary Contribution Form</h3>
          <p>
            Below is a list of voluntary P&C contributions for Ermington Public School. Monies raised from the voluntary
            contributions go towards funding important educational resources and infrastructure at the school.
            They will also help with the maintenance of the school grounds.
            <p>
              In previous years this included IT resources such as laptops and iPads, air conditioning units in the
              computer lab, english and maths resources, the sunshade behind the kindergarten classrooms, in class flip
              tables and funding for extra teaching resources. </p>
          </p>
          <form id='contribForm' class="border border-light p-5">

            <p class="h4 mb-4 text-center">Details (for receipt)</p>
            <small>All fields are required for submission.</small>

            <div class="form-row">
              <div class="form-group col-md-10 col-xs-10">
                <input class="p-2 form-control" name="email" type="email" name="email" id="email" placeholder="E-mail" required>
              </div>
              <div class="form-group col-md-2 col-xs-2">
                <img class="arrow" src="images/arrow-left.svg">
                <img class="arrow" src="images/tick.svg">

              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-10 col-xs-10">
                <input class="p-2 form-control" name="firstName" type="text" id="firstName" class="form-control mb-4" placeholder="First Name" required>
              </div>
              <div class="form-group col-md-2 col-xs-2">
                <img class="arrow" src="images/arrow-left.svg">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-10 col-xs-10">
                <input class="p-2 form-control" name="familyName" type="text" id="familyName"  placeholder="Family Name" required>
              </div>
              <div class="form-group col-md-2 col-xs-2">
                <img class="arrow" src="images/arrow-left.svg">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-10 col-xs-10">
                <input class="p-2 form-control" name="studentName" type="text" id="studentName" 
                placeholder="Eldest Student's Name" required>
              </div>
              <div class="form-group col-md-2 col-xs-2">
                <img class="arrow" src="images/arrow-left.svg">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-10 col-xs-10">
                <select class="p-2 form-control" name="studentClass" placeholder="Eldest Student's Class" required>
                  <option value="" disabled selected>Select option</option>
                  <option value="KC">KC</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="1A">1A</option>
                  <option value="1/2W">1/2W</option>
                  <option value="2D">2D</option>
                  <option value="2T">2T</option>
                  <option value="3J">3J</option>
                  <option value="3W">3W</option>
                  <option value="4D">4D</option>
                  <option value="4L">4L</option>
                  <option value="5H">5H</option>
                  <option value="5M">5M</option>
                  <option value="6/5L">6/5L</option>
                  <option value="6C">6C</option>
                  <option value="6G">6G</option>
                </select>
              </div>
              <div class="form-group col-md-2 col-xs-2">
                <img class="arrow" src="images/arrow-left.svg">
              </div>
            </div>

            <div class="card mb-4">
              <div class="card-body">
                <p>Which fund would you like to contribute to?</p>
                <!-- Group of material radios - option 1 -->
                <div class="form-check">
                  <input type="radio" class="form-check-input" id="fundGeneral" name="fund" value="general" checked
                    onchange="fundChanged()">
                  <label class="form-check-label" for="oneChild">P&C General Contribution Fund – (Non Tax-
                    Deductible)</label>
                  <p>Used to fund additional school equipment, education and teaching resources.</p>
                </div>
                <div class="form-check">
                  <input type="radio" class="form-check-input" id="fundBuilding" name="fund" value="building"
                    onchange="fundChanged()">
                  <label class="form-check-label" for="twoChild">P&C Building Fund – (100% Tax- Deductible
                    donation)</label>
                  <p>Used to purchase or replace fixed asset items – ie. new buildings, building improvements, air
                    conditioning or other permanent fixtures</p>
                </div>
              </div>
            </div>

            <div class="card mb-4">
              <div class="card-body">
                <p>How many students do you have at Ermington?</p>
                <!-- Group of material radios - option 1 -->
                <div class="form-check">
                  <input type="radio" class="form-check-input" id="oneChild" name="numberChildren" value="1"
                    onchange="numChildrenChanged()">
                  <label class="form-check-label" for="oneChild">One student (suggested donation $ 60.00)</label>
                </div>
                <div class="form-check">
                  <input type="radio" class="form-check-input" id="twoChild" name="numberChildren" value="2" checked
                    onchange="numChildrenChanged()">
                  <label class="form-check-label" for="twoChild">More than one student(suggested donation $
                    100.00)</label>
                </div>
              </div>
            </div>

            <div class="card mb-4">
              <div class="card-body">
                <p>Would you like to make an additional $50 contribution toward Ground Maintenance – (Non Tax-
                  Deductible)?</p>
                <!-- Group of material radios - option 1 -->
                <div class="form-check">
                  <input type="radio" class="form-check-input" id="groundMaintenanceYes" name="groundMaintenance"
                    value="yes" checked onchange="groundMaintenanceChanged()">
                  <label class="form-check-label" for="oneChild">Yes</label>
                </div>
                <div class="form-check">
                  <input type="radio" class="form-check-input" id="groundMaintenanceNo" name="groundMaintenance"
                    value="no" onchange="groundMaintenanceChanged()">
                  <label class="form-check-label" for="twoChild">No</label>
                </div>
              </div>
            </div>

            <div class="card text-center">
              <div class="card text-center" style="margin:0.5em;">
                <div class="card-body">
                  <snall>This shows your suggested student contribution. If your circumstances prevent you paying this
                    much - or
                    allow you to give more then use the buttons to adjust the amount.</small>
                </div>
              </div>
              <input type="hidden" id="childAmount" val="60">
              <div class="card-body">
                <ul id="amount" onclick="amountClicked(event);">
                  <li value="20">$20</li>
                  <li value="40">$40</li>
                  <li value="60">$60</li>
                  <li value="80">$80</li>
                  <li value="100">$100</li>
                  <li value="130">$130</li>
                  <li value="150">$150</li>
                  <li value="250">$250</li>
                  <li value="300">$300</li>
                  <li value="500">$500</li>
                </ul>
              </div>
            </div>

            <p class="h4 mb-4 text-center">Totals</p>
            <div class="card mb-4">
              <div class="card-body">
                <table>
                  <tr>
                    <td class="col-sm-9">Suggested Contribution <span id="childType">(One Child)</span></td>
                    <td class="col-sm-3 rowTotal" id="suggestedContribution">$80.00</td>
                  </tr>
                  <tr>
                    <td class="col-sm-9">Grounds maintenance contribution</td>
                    <td class="col-sm-3 rowTotal" id="groundsContribution">$50.00</td>
                  </tr>
                  <tr>
                    <td class="col-sm-9">Total:</td>
                    <td class="col-sm-3 rowTotal" id="totalContribution">$130.00</td>
                  </tr>
                </table>
              </div>
            </div>

            <button class="btn btn-info btn-block my-4" onclick="submitContribution(event)">Proceed to Payment</button>


          </form> <!-- Default form register -->
          <form id='contribOnly' style="visibility: hidden;" action="https://www.paypal.com/cgi-bin/webscr"
            method="post" target="_top">
            <input type="hidden" name="cmd" value="_s-xclick">
            <input type="hidden" name="hosted_button_id" value="4MYP8L6PVUE3Q">
            <table>
              <tr>
                <td><input type="hidden" name="on0" value="Contribution">Contribution</td>
              </tr>
              <tr>
                <td><select name="os0">
                    <option value="c20">c20 $20.00 AUD</option>
                    <option value="c40">c40 $40.00 AUD</option>
                    <option value="c60">c60 $60.00 AUD</option>
                    <option value="c80">c80 $80.00 AUD</option>
                    <option value="c100">c100 $100.00 AUD</option>
                    <option value="c130">c130 $130.00 AUD</option>
                    <option value="c150">c150 $150.00 AUD</option>
                    <option value="c200">c200 $200.00 AUD</option>
                    <option value="c300">c300 $300.00 AUD</option>
                    <option value="c050">c050 $0.50 AUD</option>
                  </select> </td>
              </tr>
            </table>
            <input type="hidden" name="currency_code" value="AUD">
            <input type="image" src="https://www.paypalobjects.com/en_AU/i/btn/btn_paynowCC_LG.gif" border="0"
              name="submit" alt="PayPal – The safer, easier way to pay online!">
            <img alt="" border="0" src="https://www.paypalobjects.com/en_AU/i/scr/pixel.gif" width="1" height="1">
          </form>

          <form id='contribWithGrounds' style="visibility: hidden;" action="https://www.paypal.com/cgi-bin/webscr"
            method="post" target="_top">
            <input type="hidden" name="cmd" value="_s-xclick">
            <input type="hidden" name="hosted_button_id" value="KZQDD2PU8PYJW">
            <table>
              <tr>
                <td><input type="hidden" name="on0" value="Contribution50">Contribution50</td>
              </tr>
              <tr>
                <td><select name="os0">
                    <option value="c70">c70 $70.00 AUD</option>
                    <option value="c90">c90 $90.00 AUD</option>
                    <option value="c110">c110 $110.00 AUD</option>
                    <option value="c130">c130 $130.00 AUD</option>
                    <option value="c150">c150 $150.00 AUD</option>
                    <option value="c180">c180 $180.00 AUD</option>
                    <option value="c200">c200 $200.00 AUD</option>
                    <option value="c250">c250 $250.00 AUD</option>
                    <option value="c350">c350 $350.00 AUD</option>
                  </select> </td>
              </tr>
            </table>
            <input type="hidden" name="currency_code" value="AUD">
            <input type="image" src="https://www.paypalobjects.com/en_AU/i/btn/btn_paynowCC_LG.gif" border="0"
              name="submit" alt="PayPal – The safer, easier way to pay online!">
            <img alt="" border="0" src="https://www.paypalobjects.com/en_AU/i/scr/pixel.gif" width="1" height="1">
          </form>
        </div>
      </div>
      <footer class="demo-footer mdl-mini-footer">
        <div class="mdl-mini-footer--left-section">
          <ul class="mdl-mini-footer--link-list">
            <li><a href="#">Help</a></li>
            <li><a href="#">Privacy and Terms</a></li>
            <li><a href="#">User Agreement</a></li>
          </ul>
        </div>
      </footer>
    </main>
  </div>
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
  <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <script>

    var optForm = {};

    var contribExtraForm = $("#contribWithGrounds");
    var contribExtraFormOptions = $("#contribWithGrounds option").toArray();
    var contribExtraPairs = contribExtraFormOptions.
      map(function (it) {
        return [it, it.value.substring(1)];
      });

    contribExtraPairs.forEach(function (item, index) {
      optForm[item[1]] = { "form": contribExtraForm[0], "option": item[0] };
    });


    var contribOnlyForm = $("#contribOnly");
    var contribOnlyFormOptions = $("#contribOnly option").toArray();
    var contribOnlyPairs = contribOnlyFormOptions.
      map(function (it) {
        return [it, it.value.substring(1)];
      });

    contribOnlyPairs.forEach(function (item) {
      optForm[item[1]] = { "form": contribOnlyForm[0], "option": item[0] };
    });


    console.dir(optForm);

    function UUID() {
      var uuid = (function () {
        var i,
          c = "89ab",
          u = [];
        for (i = 0; i < 36; i += 1) {
          u[i] = (Math.random() * 16 | 0).toString(16);
        }
        u[8] = u[13] = u[18] = u[23] = "-";
        u[14] = "4";
        u[19] = c.charAt(Math.random() * 4 | 0);
        return u.join("");
      })();
      return {
        toString: function () {
          return uuid;
        },
        valueOf: function () {
          return uuid;
        }
      };
    }

    var selectedFund = "general";
    var numChildren = 1;
    var childContribution = 100;
    var childDescription = "One Child"
    var groundMaintenance = 50;
    var totalContribution = 150;

    var updateSuggested = function () {
      suggestedAmount = childContribution;
      selectedAmount = $("#childAmount").val();
      if (selectedAmount == 60 || selectedAmount == 100) {
        setSelectedAmount(suggestedAmount);
      }
      setSuggestedAmount(suggestedAmount);
    };

    var fundChanged = function () {
      selectedFund = $("#fundGeneral")[0].checked ? "general" : "building";
      console.log("fund changed:" + selectedFund);
    }

    var numChildrenChanged = function () {
      numChildren = $("#oneChild")[0].checked ? 1 : 2;
      console.log("numChildren changed:" + numChildren);
      childContribution = numChildren == 1 ? 60 : 100;
      childDescription = numChildren == 1 ? "One Child" : "More than one child";
      updateSuggested();
      updateSummary();
    }

    var groundMaintenanceChanged = function () {
      groundMaintenance = $("#groundMaintenanceYes")[0].checked ? 50 : 0;
      console.log("groundMaintenance changed:" + groundMaintenance);
      updateSummary();
    }


    var amountClicked = function (event) {
      var target = $(event.target);
      var amount = target.val();
      $("#amount li").removeClass("selected");
      $(target).addClass("selected");
      $("#childAmount").val(amount);
      console.log("amount changed:" + amount);
      updateSummary();
    }

    var setSuggestedAmount = function (amount) {
      $("#amount li").removeClass("suggested");
      $("#amount li[value='" + amount + "']")
        .addClass("suggested");
    }

    var setSelectedAmount = function (amount) {
      $("#amount li").removeClass("selected");
      $("#amount li[value='" + amount + "']")
        .addClass("selected");
      $("#childAmount").val(amount)
    }

    var action = $("#payButton").attr('action');
    $("#payButton").attr('action', action + "?custom=" + UUID());

    var updateSummary = function () {
      $("#childType").text(childDescription);
      var childAmount = $("#childAmount").val();
      $("#suggestedContribution").text(childAmount)
      $("#groundsContribution").text(groundMaintenance)
      totalContribution = Number(childAmount) + Number(groundMaintenance);
      $("#totalContribution").text(totalContribution)
    }
    setSelectedAmount(childContribution);
    updateSuggested();
    updateSummary();


    var submitContribution = function (event) {
      event.preventDefault();
      fetch('https://ermingtonparents.net/contrib.php', {
        method: 'post',
        body: new FormData(document.getElementById('contribForm'))
      }).then(function (text) {
        // <!DOCTYPE ....
        console.log(text);
        console.dir(optForm[totalContribution]);
      });;


    }
  </script>
</body>

</html>